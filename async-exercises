#!/bin/bash

# Async Exercises Runner
# Makes it super easy to work through the exercises

set -e

# Colors for pretty output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Function to print colored output
print_color() {
    printf "${1}${2}${NC}\n"
}

# Check if cargo is installed
if ! command -v cargo &> /dev/null; then
    print_color $RED "âŒ Cargo not found. Please install Rust first."
    exit 1
fi

# Main command routing
case "${1:-help}" in
    "list"|"ls")
        print_color $BLUE "ğŸ“š Running exercise list..."
        cargo run --bin run -- list
        ;;
    "run")
        if [ -z "$2" ]; then
            print_color $RED "âŒ Please specify an exercise (e.g., ./async-exercises run 1.1)"
            exit 1
        fi
        print_color $GREEN "ğŸš€ Running exercise $2..."
        cargo run --bin run -- run "$2"
        ;;
    "check")
        if [ -z "$2" ]; then
            print_color $RED "âŒ Please specify an exercise (e.g., ./async-exercises check 1.1)"
            exit 1
        fi
        print_color $BLUE "ğŸ” Checking exercise $2..."
        cargo run --bin run -- check "$2"
        ;;
    "test")
        if [ -z "$2" ]; then
            print_color $RED "âŒ Please specify an exercise (e.g., ./async-exercises test 1.1)"
            exit 1
        fi
        print_color $YELLOW "ğŸ§ª Testing exercise $2..."
        cargo run --bin run -- test "$2"
        ;;
    "progress")
        print_color $CYAN "ğŸ“Š Showing progress..."
        cargo run --bin run -- progress
        ;;
    "next")
        print_color $PURPLE "â­ï¸ Finding next exercise..."
        cargo run --bin run -- next
        ;;
    "reset")
        if [ -z "$2" ]; then
            print_color $RED "âŒ Please specify an exercise (e.g., ./async-exercises reset 1.1)"
            exit 1
        fi
        print_color $YELLOW "ğŸ”„ Resetting exercise $2..."
        cargo run --bin run -- reset "$2"
        ;;
    "help"|"-h"|"--help")
        print_color $BLUE "ğŸš€ Rust Async Programming Exercises"
        echo ""
        print_color $GREEN "Usage:"
        echo "  ./async-exercises <command> [exercise]"
        echo ""
        print_color $YELLOW "Commands:"
        echo "  list              ğŸ“š List all exercises"
        echo "  run <exercise>    ğŸš€ Run an exercise (e.g., 1.1)"
        echo "  check <exercise>  ğŸ” Check your solution"
        echo "  test <exercise>   ğŸ§ª Run tests for an exercise"
        echo "  progress          ğŸ“Š Show your progress"
        echo "  next              â­ï¸ Show next exercise"
        echo "  reset <exercise>  ğŸ”„ Reset exercise to original state"
        echo "  help              â“ Show this help"
        echo ""
        print_color $CYAN "Examples:"
        echo "  ./async-exercises list"
        echo "  ./async-exercises run 1.1"
        echo "  ./async-exercises check 1.1"
        echo "  ./async-exercises progress"
        echo "  ./async-exercises next"
        ;;
    *)
        print_color $RED "âŒ Unknown command: $1"
        print_color $YELLOW "Run './async-exercises help' for usage information"
        exit 1
        ;;
esac